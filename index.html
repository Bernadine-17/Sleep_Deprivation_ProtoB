<!DOCTYPE html> 
<html> 
<!-- The following code has been developed by students and/or researchers of the Freshman Research Initiative DIY Diagnostics Stream at The University of Texas at Austin.  This code is shared for demonstration purposes and should not be considered a product -- it is for entertainment purposes only.  Any user of this code does so at their own risk. Members of the DIY Stream, FRI, and The University of Texas system are not liable for anything related to this code.
  
 
Authors in chronological order of contribution:
Alijah James
Emma Aldred
Tim Riedel
 
Further Information:
http://cns.utexas.edu/fri
 
Research Educator:
Timothy Riedel
triedel@utexas.edu
 
Brief Description of Goal of Code:
The goal is to create a web-based app that helps users who are likely to be college students determine if they are sleep deprived.
 
Known Issues:
Has not yet been determined if this app can accurately diagnose sleep deprivation.
No current function to output diagnostic.
User must refresh the pape if on a mobile phone with it in a horizontal orientation to get the canvas to be the correct width
-->
	<head>
		<title>Sleep Deprivation</title> <!--overall title seen on tab-->
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
		<!--set up of the style of the web page-->
	</head>
		
	<script>
		var docMod = document.lastModified; // loads last modified time stamp into docMod variable
			alert("This file last modified " + docMod); // generates alert box with time stamp. If annoying, comment out this entire line.
			console.log("This file last modified " + docMod); // generates message in javaScript console (found in developers tools) with time stamp.
		
		var startTime, endTime; //variable to record time start and end
		var user_saccade=[]; //array variable to record list of times
		
		function start() {
			//alert("Start function is being called");
			startTime = new Date(); //calls start time
		}
		var w = window.innerWidth;
		var h = 100;
		
		function draw(){
			var mycanvas;//variable set up to create a drawing canvas
			var mycontext;//variable to provide context to the above canvas
			mycanvas = document.getElementById("canvas"); //finds the canvas with the Id 'canvas'
			mycontext = mycanvas.getContext("2d");//sets up the context of the function with 2d
			mycontext.canvas.width = w;
			mycontext.canvas.height = h;
			var circlew = w/2;
			var circleh = h/2;
			mycontext.beginPath();//start drawing circle
			mycontext.arc(circlew, circleh, 10, 0, 2 * Math.PI);//dimensions of circle
			mycontext.stroke();//printing actual line
			mycontext.fillStyle = "red"; //defines fills with red 
			mycontext.fill(); //fills in circle
		}
		
		var i = 0; //counting variable to keep track of user's # of times recorded
		var width = 0; //initialized width
		
		var rand = 0;
		
		function letterdelay(){
			rand = Math.random()*2000;
			setTimeout(letter, 1000 + rand);
		}
		//document.addEventListener("load", letterdelay, false);
		
		function letter(){
			var randomletter = Math.random().toString(36).replace(/[^a-z]+/g, '').substr(0,1).split('').map(c => Math.random() < 0.5 ? c.toUpperCase() : c).join('');
			//random letter
			var mycanvas = document.getElementById("canvas"); //finds the canvas with the Id 'a'
			var mycontext = mycanvas.getContext("2d");
			//mycontext.canvas.width = w;
			//mycontext.canvas.height = h;//sets up the context of the function with 2dv
			if (i % 2 == 0){
				width = 1;//will print letter on left of canvas
			}
			else{
				width = w-45;//will print letter on right of canvas
			}
			var medium_h = h/2;
			mycontext.font = "bold 24px sans-serif"; //determines the font of the text
			mycontext.fillStyle = "black"; //color for letter
			mycontext.fillText(randomletter,width,medium_h); //declares and prints the text and gives placement
			i++;//adds to counting variable, adds one
			document.getElementById("repeats").innerHTML = i; //prints the number of trials recorded by user
			if (i==20){
				alert("You have reached 20 trials! Go get your results.");
			}
		}
		
		var timeDiff;//variable to record difference in start and stop time
		
		function stop() {
			//var g = 1000; //delay time in ms for letter
			endTime = new Date();//records new time
			timeDiff = endTime - startTime - rand; //change in start and end time in ms
				// strip the ms
			timeDiff /= 1000;
				// get seconds 
			document.getElementById("dif").innerHTML = timeDiff; //prints the timeDiff
			user_saccade.push(timeDiff);//adds timeDiff to the array
			document.getElementById("fullresults").innerHTML = user_saccade.join('<br>'); //prints list of time
			
		}
		var avg = 0;
		function average(){
			var sum = user_saccade.reduce((previous, current) => current += previous);//sums list of times
			avg = sum/user_saccade.length;//divides sum by the # of times in array to get average
			document.getElementById("avg").innerHTML = avg; //prints average
			//if MEANSLEEPDEPRIVEDSPEED
		}
		
		function restart(){
			user_saccade=[];
			i = 0;
			var mycanvas = document.getElementById("canvas"); //finds the canvas with the Id 'a'
			var mycontext = mycanvas.getContext("2d"); //sets up the context of the function with 2d
			mycanvas.width=w; //resets canvas width to 650
			mycanvas.height=h; //resets canvas height to 350
		}
		 // Copy canvas as image data
 		var imgData = mycontext.getImageData(0,0, mycanvas.width, 100);
 
  		// Resize original canvas
  		mycanvas.width = window.innerWidth;
  		mycanvas.height = 100;
 
  		// Copy back to resized canvas
  		mycontext.putImageData(imgData, 0, 0);
		
		function init() {
        		mycanvas = document.getElementById("canvas");
        		if (mycanvas.getContext) {
          			mycontext = mycanvas.getContext("2d");
 
          		window.addEventListener('resize', resizeCanvas, false);
          		window.addEventListener('orientationchange', resizeCanvas, false);
          		resizeCanvas();
        		}
     		}
 
      		function resizeCanvas() {
        		mycanvas.width = window.innerWidth;
        		mycanvas.height = 100;
      		}
		
		function diagnose() {
			var givensleepy = 0.8162156732;
			var sleepy = avg - givensleepy;
			var givenawake = 0.5608123848;
			var awake = avg - givenawake;
			var report_sleepy = "Your saccadic velocity indicates that you are sleep deprived";
			var report_awake = "Your saccadic velocity does not indicates that you are sleep deprived";
			if (Math.abs(sleepy) > Math.abs(awake)){
				document.getElementById("diagnose").innerHTML = report_sleepy;
			}
			else{
				document.getElementById("diagnose").innerHTML = report_awake;
			}
		}
					
	</script>
	
	<style>
		.button {
			background-color: #99ccff; /* blue */
			border: black;
			color: black;
			padding: 15px 32px;
			text-align: center;
			text-decoration: none;
			display: inline-block;
			font-size: 16px;
			margin: 4px 2px;
			cursor: pointer;
		}
		.button1 {width: 250px;}
		.button2 {width: 50%;}
		.button3 {width: 100%;}
		
		/*.container {
  			display: flex;
  			justify-content: space-around;
  			align-items: flex-start;
		}
		.container-2 {width: 100%}*/
		
		.sticky {
  			position: -webkit-sticky;
 			position: sticky;
  			top: 29px;
			/*bottom: container-2;*/
  			padding: 10px;
  			/*top: 10rem;*/
		}	
	</style>
	
	<body>
		<!-- Navbar (sit on top) -->
		<div class="w3-top">
			<div class="w3-bar w3-white w3-ppadding w3-wide w3-card">
				<!--<a href="#home" class="w3-bar-item w3-button"><b>Sleep Deprivation Diagnostic</b> - DIY</a>-->
				<b>Sleep Deprivation</b>  Diagnostic
		<!-- Float links to the right. Hide them on small screens -->
    			<div class="w3-right w3-hide-small">
				<a href="#home" class="w3-bar-item w3-button">Background</a>
				<a href="#instructions" class="w3-bar-item w3-button">Instructions</a>
				<a href="#test" class="w3-bar-item w3-button">Test</a>
				<a href="#results" class="w3-bar-item w3-button">Results</a>
			</div>
			</div>
		</div>
		<header class="w3-display-container w3-content w3-wide" style="max-width:1500px;" id="home">
			<h1 class="w3-xxlarge w3-text-white">Sleep Deprivation Diagnostic</h1>
		<!--header displayed on top of web page-->
			
		<!-- Page content -->
		<div class="w3-content w3-padding" style="max-width:1564px">
		<!--set up for all pages-->
			<div class="w3-container w3-padding-32" id="home">
				<h3 class="w3-border-bottom w3-border-light-grey w3-padding-16">Background</h3>
			</div>
			<!--home page with header-->
			<p>
			Sleep deprivation is known to negatively affect the mind in various ways. Saccadeds are the 
			semi-involuntary, fast movements of your eyes to focus on a new point. Although they can be controlled
			consciously, their involuntary element allows them to be a measurement tool for sleep deprivation. When 
			sleep deprived, the velocity of saccadic movements (degrees/sec) are slowed. This app will measure your 
			saccadic velocity to determine if you are sleep deprived or not.
			</p>
			<!--prints backgroun information about sleep deprivation and saccadic velocity-->
			<!--instruction page-->
			<div class="w3-container w3-padding-32" id="instructions">
				<h3 class="w3-border-bottom w3-border-light-grey w3-padding-16">Instructions</h3>
			</div>
			<p>This app will diagnose if you are sleep deprived by measuring you horizontal saccadic velocity.
				Hold your device horizontally (longways) around an arms length distance from your face. Refresh your page so
				that testing canvas appears in the correct orientation. When ready, press start 
				and stare at the red dot. A black letter will flash on either side of the dot. 
				When you see this letter, press the stop button. This will record an individual saccade in seconds. 
				You will be alerted when you complete 20 trials. Find the test under the "Test" tab above or scroll down.
			</p>
			<!--prints instructions to use app-->
			
			<div class="w3-container w3-padding-32" id="test">
				<h3 class="w3-border-bottom w3-border-light-grey w3-padding-16">Test</h3>
			</div>
			
            		<!--test page with header-->
				<!--below buttons call the functions listed within them when pressed-->
			<!--<scroller>-->
				<!--<div class="sticky">
				<!--<div item>-->
			<!--<div class="uk-child-width-1-2@s" uk-grid>
    				<div>-->
            			<!--	<div class="sticky">-->
						<div description><button class="button button2" onclick="start();draw();letterdelay();">Start</button></div><!--setTimeout calls letter but delays by 1 sec-->
						<div description><button class="button button2" onclick="stop();">Stop</button></div>
				<!--	</div>-->
    				<!--</div>
			</div>-->
    				
			<canvas id= "canvas" style= "border:1px solid #000000;"></canvas>
			
			<!--<p id="container-2">Make a mistake? No worries. Press this button to start over.</p>
			<button onclick="restart();">Start over</button>-->
				
			
					
					<!--<button class="button button3" onclick="reset();">Reset</button>setTimeout(letter,1000);-->
					
					
					
				<!--</div>
				<!--</div>-->
				
				<!--<div item>
					<div description><span>----</span></div>
				</div>-->
			<!--</scroller>-->
				<!--<div class="resize-container">
					<div class="resize-drag">
						<canvas id= "canvas" style= "border:1px solid #000000;"></canvas>
					</div>
				</div>-->
				<!--creates canvas-->
		
			<p>Make a mistake? No worries. Press this button to start over.</p>
				<button onclick="restart();">Start over</button>
		
			<p><strong>Saccade Time (seconds)</strong></p>
			<p id="dif"></p><!--prints time difference-->
			<p><strong>Trials completed</strong> 
			<p id="repeats"></p><!--prints the number of saccades recorded-->
				
			

			<div class="w3-container w3-padding-32" id="results">
				<h3 class="w3-border-bottom w3-border-light-grey w3-padding-16">Results</h3>
			</div>
			<!--results page with header-->
				<p><strong>Here is a list of all your individual saccade times in seconds</strong></p>
				<p id="fullresults"></p>
				<!--prints description and of list of individual time differences-->
				<button onclick="average();">Get Average</button>
				<!--calls function to calculate average-->
				<p id="avg"></p>
				<!--prints average-->
				<button onclick="diagnose();">Diagnosis</button>
				<p id ="diagnose"></p>
				
		</div><!--ends page content-->
		
		<footer class="w3-center w3-black w3-padding-16">
			<b>DIY Diagnostics</b>
			<p><small>The following code has been developed by students and/or researchers of the Freshman Research 
				Initiative DIY Diagnostics Stream at The University of Texas at Austin.  This code is shared for demonstration 
				purposes and should not be considered a product -- it is for entertainment purposes only. Any user of this code 
				does so at their own risk. Members of the DIY Stream, FRI, and The University of Texas system are not liable for 
				anything related to this code.</small></p>
 			<p><small>THIS CODE SHOULD NOT BE USED TO DIAGNOSE ANY KIND OF MEDICAL CONDITION.</small></p>
		</footer>
		<!-- footer -->
  	 </body>
</html>
